<!DOCTYPE html>
<html lang="en" data-theme="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FileCloud - Dashboard</title>
        <link rel="icon" href="/logo/logo.png" type="image/png" />
        <link rel="stylesheet" href="styles.css" />
        <link rel="stylesheet" href="home.css" />
    </head>
    <body>
        <div class="app-container">
            <!-- Sidebar -->
            <%- include("partials/sidebar.ejs") %>
            <!-- Main Content with Header -->
            <main class="main-content">
                <!-- Header -->
                <%- include("partials/header.ejs") %>

                <!-- Content Area -->
                <div class="content">
                    <% if (locals.path) {%>
                    <!--folder content -->
                    <%- include("partials/folderContent.ejs", {files:
                    locals.files}) %> <%} else {%>
                    <!-- Files grid -->
                    <%- include("partials/filesGrid.ejs") %> <% } %>
                </div>
            </main>
        </div>

        <!-- Upload Modal -->
        <div id="uploadModal" class="modal">
            <form
                action="<%= locals.path %>/new/file"
                method="post"
                class="modal-content"
                enctype="multipart/form-data"
            >
                <div class="modal-header">
                    <h3>Upload Files</h3>
                </div>
                <div class="form-group">
                    <label for="fileInput">Select files to upload</label>
                    <input
                        type="file"
                        id="fileInput"
                        class="form-input"
                        multiple
                        name="file"
                    />
                </div>
                <input
                    type="hidden"
                    name="fileType"
                    id="fileType"
                    value="<%= locals.fileType %>"
                />
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('uploadModal')"
                    >
                        Cancel
                    </button>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        onclick="uploadFiles()"
                    >
                        Upload
                    </button>
                </div>
            </form>
        </div>

        <!-- Create Folder Modal -->
        <div id="createFolderModal" class="modal">
            <form
                action="<%= locals.path %>/new/folder"
                method="post"
                class="modal-content"
            >
                <div class="modal-header">
                    <h3>Create New Folder</h3>
                </div>
                <div class="form-group">
                    <label for="folderName">Folder Name</label>
                    <input
                        type="text"
                        id="folderName"
                        class="form-input"
                        placeholder="Enter folder name"
                        name="folderName"
                    />
                </div>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('createFolderModal')"
                    >
                        Cancel
                    </button>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        onclick="createFolder()"
                    >
                        Create
                    </button>
                </div>
            </form>
        </div>

        <!-- Share Modal -->
        <div id="shareModal" class="modal">
            <form
                action="<%= locals.path %>/share"
                method="post"
                class="modal-content"
            >
                <div class="modal-header">
                    <h3>Share File</h3>
                </div>
                <div class="form-group">
                    <label for="shareEmail">Email Address</label>
                    <input
                        type="email"
                        id="shareEmail"
                        class="form-input"
                        placeholder="Enter email address"
                        name="shareEmail"
                    />
                </div>
                <div class="form-group">
                    <label for="sharePermission">Permission</label>
                    <select id="sharePermission" class="form-input">
                        <option value="view">Can View</option>
                        <option value="edit">Can Edit</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('shareModal')"
                    >
                        Cancel
                    </button>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        onclick="shareFile()"
                    >
                        Share
                    </button>
                </div>
            </form>
        </div>

        <!-- Rename Modal -->
        <div id="renameModal" class="modal">
            <form
                action="<%= locals.path %>/rename/file"
                method="post"
                class="modal-content"
            >
                <div class="modal-header">
                    <h3>Rename File</h3>
                </div>
                <div class="form-group">
                    <label for="newFileName">New Name</label>
                    <input
                        type="text"
                        id="newFileName"
                        class="form-input"
                        placeholder="Enter new file name"
                        name="newFileName"
                    />
                </div>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('renameModal')"
                    >
                        Cancel
                    </button>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        onclick="renameFile()"
                    >
                        Rename
                    </button>
                </div>
            </form>
        </div>

        <!-- Delete Modal -->
        <div id="deleteModal" class="modal">
            <form
                action="<%= locals.path %>"
                method="post"
                class="modal-content"
            >
                <div class="modal-header">
                    <h3>Delete File</h3>
                </div>
                <p>
                    Are you sure you want to delete the selected file(s)? This
                    action cannot be undone.
                </p>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('deleteModal')"
                    >
                        Cancel
                    </button>
                    <button
                        type="submit"
                        class="btn btn-danger"
                        onclick="deleteFile()"
                    >
                        Delete
                    </button>
                </div>
            </form>
        </div>

        <script>
            // Modal functions
            function openUploadModal() {
                document.getElementById("uploadModal").classList.add("active");
            }

            function openCreateFolderModal() {
                document
                    .getElementById("createFolderModal")
                    .classList.add("active");
            }

            function openShareModal() {
                document.getElementById("shareModal").classList.add("active");
            }

            function openRenameModal() {
                document.getElementById("renameModal").classList.add("active");
            }

            function openDeleteModal() {
                document.getElementById("deleteModal").classList.add("active");
            }

            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove("active");
            }

            // Action functions
            function uploadFiles() {
                const fileInput = document.getElementById("fileInput");
                if (fileInput.files.length > 0) {
                    closeModal("uploadModal");
                } else {
                    alert("Please select files to upload");
                }
            }

            function createFolder() {
                const folderName = document.getElementById("folderName").value;
                if (folderName) {
                    alert(`Creating folder: ${folderName}`);
                    closeModal("createFolderModal");
                } else {
                    alert("Please enter a folder name");
                }
            }

            function shareFile() {
                const email = document.getElementById("shareEmail").value;
                const permission =
                    document.getElementById("sharePermission").value;
                if (email) {
                    alert(
                        `Sharing file with ${email} (${permission} permission)`
                    );
                    closeModal("shareModal");
                } else {
                    alert("Please enter an email address");
                }
            }

            function renameFile() {
                const newName = document.getElementById("newFileName").value;
                if (newName) {
                    alert(`Renaming file to: ${newName}`);
                    closeModal("renameModal");
                } else {
                    alert("Please enter a new file name");
                }
            }

            function downloadFile() {
                alert("Downloading selected file(s)...");
            }

            function deleteFile() {
                if (
                    confirm(
                        "Are you sure you want to delete the selected file(s)?"
                    )
                ) {
                    alert("Deleting file(s)...");
                    closeModal("deleteModal");
                }
            }

            // Close modal when clicking outside
            window.addEventListener("click", function (event) {
                const modals = document.querySelectorAll(".modal");
                modals.forEach((modal) => {
                    if (event.target === modal) {
                        modal.classList.remove("active");
                    }
                });
            });

            // File selection
            const categories = document.querySelectorAll(".category");
            categories.forEach((category) => {
                category.addEventListener("click", function (e) {
                    const className = this.classList[0];
                    const elements = document.querySelectorAll(`.${className}`);
                    const activeElements = document.querySelectorAll(".active");

                    // remove active class
                    if (activeElements) {
                        activeElements.forEach((element) => {
                            element.classList.remove("active");
                        });
                    }

                    // add active class
                    elements.forEach((element) => {
                        element.classList.add("active");
                    });
                });
            });

            // Initialize theme
            function initTheme() {
                const savedTheme = localStorage.getItem("theme") || "dark";
                document.documentElement.setAttribute("data-theme", savedTheme);
            }

            initTheme();
        </script>
    </body>
</html>
