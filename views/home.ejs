<!DOCTYPE html>
<html lang="en" data-theme="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FileCloud - Dashboard</title>
        <link rel="icon" href="/logo/logo.png" type="image/png" />
        <link rel="stylesheet" href="styles.css" />
        <link rel="stylesheet" href="home.css" />
    </head>
    <body>
        <div class="app-container">
            <!-- Sidebar -->
            <%- include("partials/sidebar.ejs") %>
            <!-- Main Content with Header -->
            <main class="main-content">
                <!-- Header -->
                <%- include("partials/header.ejs") %>

                <!-- Content Area -->
                <div class="content">
                    <% if (!locals.notHome) {%>
                    <div class="files-grid">
                        <a
                            href="/Downloads"
                            class="downloads category file-card"
                        >
                            <h3>Documents</h3>
                            <div class="file-card-summary">
                                <p>2.4 MB</p>
                                <p class="file-amount">4 files</p>
                            </div>
                        </a>
                        <a href="/Images" class="images category file-card">
                            <h3>Images</h3>
                            <div class="file-card-summary">
                                <p>1.4 MB</p>
                                <p class="file-amount">10 files</p>
                            </div>
                        </a>
                        <a href="/Videos" class="videos category file-card">
                            <h3>Videos</h3>
                            <div class="file-card-summary">
                                <p>215.4 MB</p>
                                <p class="file-amount">5 files</p>
                            </div>
                        </a>
                    </div>
                    <div class="content-header">
                        <h2>Recent Files</h2>
                    </div>
                    <%} else {%>
                    <h2>Documents</h2>
                    <% } %>
                </div>
            </main>
        </div>

        <!-- Upload Modal -->
        <div id="uploadModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Upload Files</h3>
                </div>
                <div class="form-group">
                    <label for="fileInput">Select files to upload</label>
                    <input
                        type="file"
                        id="fileInput"
                        class="form-input"
                        multiple
                    />
                </div>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('uploadModal')"
                    >
                        Cancel
                    </button>
                    <button class="btn btn-primary" onclick="uploadFiles()">
                        Upload
                    </button>
                </div>
            </div>
        </div>

        <!-- Create Folder Modal -->
        <div id="createFolderModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create New Folder</h3>
                </div>
                <div class="form-group">
                    <label for="folderName">Folder Name</label>
                    <input
                        type="text"
                        id="folderName"
                        class="form-input"
                        placeholder="Enter folder name"
                    />
                </div>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('createFolderModal')"
                    >
                        Cancel
                    </button>
                    <button class="btn btn-primary" onclick="createFolder()">
                        Create
                    </button>
                </div>
            </div>
        </div>

        <!-- Share Modal -->
        <div id="shareModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Share File</h3>
                </div>
                <div class="form-group">
                    <label for="shareEmail">Email Address</label>
                    <input
                        type="email"
                        id="shareEmail"
                        class="form-input"
                        placeholder="Enter email address"
                    />
                </div>
                <div class="form-group">
                    <label for="sharePermission">Permission</label>
                    <select id="sharePermission" class="form-input">
                        <option value="view">Can View</option>
                        <option value="edit">Can Edit</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('shareModal')"
                    >
                        Cancel
                    </button>
                    <button class="btn btn-primary" onclick="shareFile()">
                        Share
                    </button>
                </div>
            </div>
        </div>

        <!-- Rename Modal -->
        <div id="renameModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Rename File</h3>
                </div>
                <div class="form-group">
                    <label for="newFileName">New Name</label>
                    <input
                        type="text"
                        id="newFileName"
                        class="form-input"
                        placeholder="Enter new file name"
                    />
                </div>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('renameModal')"
                    >
                        Cancel
                    </button>
                    <button class="btn btn-primary" onclick="renameFile()">
                        Rename
                    </button>
                </div>
            </div>
        </div>

        <!-- Delete Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Delete File</h3>
                </div>
                <p>
                    Are you sure you want to delete the selected file(s)? This
                    action cannot be undone.
                </p>
                <div class="modal-actions">
                    <button
                        class="btn btn-secondary"
                        onclick="closeModal('deleteModal')"
                    >
                        Cancel
                    </button>
                    <button class="btn btn-danger" onclick="deleteFile()">
                        Delete
                    </button>
                </div>
            </div>
        </div>

        <script>
            // Modal functions
            function openUploadModal() {
                document.getElementById("uploadModal").classList.add("active");
            }

            function openCreateFolderModal() {
                document
                    .getElementById("createFolderModal")
                    .classList.add("active");
            }

            function openShareModal() {
                document.getElementById("shareModal").classList.add("active");
            }

            function openRenameModal() {
                document.getElementById("renameModal").classList.add("active");
            }

            function openDeleteModal() {
                document.getElementById("deleteModal").classList.add("active");
            }

            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove("active");
            }

            // Action functions
            function uploadFiles() {
                const fileInput = document.getElementById("fileInput");
                if (fileInput.files.length > 0) {
                    alert(`Uploading ${fileInput.files.length} file(s)...`);
                    closeModal("uploadModal");
                } else {
                    alert("Please select files to upload");
                }
            }

            function createFolder() {
                const folderName = document.getElementById("folderName").value;
                if (folderName) {
                    alert(`Creating folder: ${folderName}`);
                    closeModal("createFolderModal");
                } else {
                    alert("Please enter a folder name");
                }
            }

            function shareFile() {
                const email = document.getElementById("shareEmail").value;
                const permission =
                    document.getElementById("sharePermission").value;
                if (email) {
                    alert(
                        `Sharing file with ${email} (${permission} permission)`
                    );
                    closeModal("shareModal");
                } else {
                    alert("Please enter an email address");
                }
            }

            function renameFile() {
                const newName = document.getElementById("newFileName").value;
                if (newName) {
                    alert(`Renaming file to: ${newName}`);
                    closeModal("renameModal");
                } else {
                    alert("Please enter a new file name");
                }
            }

            function downloadFile() {
                alert("Downloading selected file(s)...");
            }

            function deleteFile() {
                if (
                    confirm(
                        "Are you sure you want to delete the selected file(s)?"
                    )
                ) {
                    alert("Deleting file(s)...");
                    closeModal("deleteModal");
                }
            }

            // Close modal when clicking outside
            window.addEventListener("click", function (event) {
                const modals = document.querySelectorAll(".modal");
                modals.forEach((modal) => {
                    if (event.target === modal) {
                        modal.classList.remove("active");
                    }
                });
            });

            // File selection
            const categories = document.querySelectorAll(".category");
            categories.forEach((category) => {
                category.addEventListener("click", function (e) {
                    const className = this.classList[0];
                    const elements = document.querySelectorAll(`.${className}`);
                    const activeElements = document.querySelectorAll(".active");

                    // remove active class
                    if (activeElements) {
                        activeElements.forEach((element) => {
                            element.classList.remove("active");
                        });
                    }

                    // add active class
                    elements.forEach((element) => {
                        element.classList.add("active");
                    });
                });
            });

            // Initialize theme
            function initTheme() {
                const savedTheme = localStorage.getItem("theme") || "dark";
                document.documentElement.setAttribute("data-theme", savedTheme);
            }

            initTheme();
        </script>
    </body>
</html>
